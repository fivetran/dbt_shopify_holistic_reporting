name: 'shopify_holistic_reporting_integration_tests'
version: '0.9.0'
profile: 'integration_tests'
config-version: 2

clean-targets:         # directories to be removed by `dbt clean`
  - "target"
  - "dbt_packages"
  - "dbt_modules"

vars:
  shopify_source:
    shopify_using_fulfillment_event: true
    shopify_schema: 'combo_integration_tests_12'
    shopify_order_identifier: 'order_table' # reserved keyword in snowflake

  klaviyo_source:
    klaviyo_schema: 'combo_integration_tests_12'
    klaviyo_campaign_identifier: "klaviyo_campaign"
    klaviyo_event_identifier: "klaviyo_event"
    klaviyo_flow_identifier: "klaviyo_flow"
    klaviyo_person_identifier: "klaviyo_person"
    klaviyo_metric_identifier: "klaviyo_metric"

models:
  +schema: "combo_reporting_{{ var('directed_schema','dev') }}"

dispatch:
  - macro_namespace: dbt_utils
    search_order: ['shopify_holistic_reporting', 'spark_utils', 'dbt_utils']

seeds:
  shopify_holistic_reporting_integration_tests:
  # shopify
    +quote_columns: "{{ true if target.type in ('redshift', 'postgres') else false }}"
    +column_types:
      _fivetran_synced: timestamp
    customer:
      +column_types:
        created_at: timestamp
        updated_at: timestamp
        _fivetran_synced: timestamp
        id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        default_address_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        email: "{{ 'string' if target.type in ('bigquery', 'spark', 'databricks') else 'varchar' }}"
    order:
      +column_types:
        created_at: timestamp
        updated_at: timestamp
        processed_at: timestamp
        cancelled_at: timestamp
        _fivetran_synced: timestamp
        id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        customer_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        location_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        user_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
      +alias: order_table
    order_line:
      +column_types:
        _fivetran_synced: timestamp
        order_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        product_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        variant_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
    order_line_refund:
      +column_types:
        _fivetran_synced: timestamp
        id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        location_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        refund_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        order_line_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
    product:
      +column_types:
        created_at: timestamp
        updated_at: timestamp
        published_at: timestamp
        _fivetran_synced: timestamp
        id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
    order_adjustment:
      +column_types:
        id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        order_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        refund_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
    product_variant:
      +column_types:
        id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        product_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        inventory_item_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
    transaction:
      +column_types:
        id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        order_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        refund_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        receipt: "{{ 'varchar(100)' if target.name in ('redshift', 'postgres') else 'string' }}"
    refund:
      +column_types:
        id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        order_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
        user_id: "{%- if target.type == 'bigquery' -%} INT64 {%- else -%} bigint {%- endif -%}"
    abandoned_checkout_discount_code:
      +column_types:
        amount: float
        created_at: timestamp
        updated_at: timestamp
    abandoned_checkout:
      +column_types:
        total_line_items_price: float
        billing_address_phone: "{{ 'string' if target.type in ('bigquery', 'spark', 'databricks') else 'varchar' }}"
        shipping_address_phone: "{{ 'string' if target.type in ('bigquery', 'spark', 'databricks') else 'varchar' }}"
        closed_at: timestamp
        created_at: timestamp
        updated_at: timestamp
        _fivetran_deleted: boolean
    discount_code:
      +column_types:
        usage_count: float
    order_discount_code:
      +column_types:
        amount: float
    order_shipping_tax_line:
      +column_types:
        price: float
    order_shipping_line:
      +column_types:
        discounted_price: float
        price: float
    price_rule:
      +column_types:
        prerequisite_subtotal_range: float
        value: float
    collection:
      +column_types:
        disjunctive: boolean
        published_at: timestamp
        updated_at: timestamp
        title: "{{ 'string' if target.type in ('bigquery', 'spark', 'databricks') else 'varchar' }}"
    metafield:
      +column_types:
        value_type: "{{ 'string' if target.type in ('bigquery', 'spark', 'databricks') else 'varchar' }}"
        type: "{{ 'string' if target.type in ('bigquery', 'spark', 'databricks') else 'varchar' }}"
    shop:
      +column_types:
        taxes_included: boolean
        google_apps_login_enabled: boolean
        county_taxes: boolean
    inventory_level:
      +column_types:
        updated_at: timestamp
    inventory_item:
      +column_types:
        updated_at: timestamp
        created_at: timestamp
    abandoned_checkout_shipping_line:
      +column_types:
        markup: "{{ 'string' if target.type in ('bigquery', 'spark', 'databricks') else 'varchar' }}"
        price: float
        original_shop_markup: "{{ 'string' if target.type in ('bigquery', 'spark', 'databricks') else 'varchar' }}"
        original_shop_price: "{{ 'string' if target.type in ('bigquery', 'spark', 'databricks') else 'varchar' }}"
    tax_line:
      +column_types:
        price: float
        rate: float
    # klaviyo
    klaviyo_person:
      +tags: klaviyo
      +column_types:
        phone_number: "{{ 'string' if target.type in ('bigquery', 'spark', 'databricks') else 'varchar' }}"
    klaviyo_flow:
      +tags: klaviyo
      +enabled: "{{ true if target.type != 'snowflake' else false }}"
      +quote_columns: "{{ true if target.type == 'redshift' else false }}"
    klaviyo_event:
      +tags: klaviyo
      +column_types:
        flow_id: "{{ 'string' if target.type in ('bigquery', 'spark', 'databricks') else 'varchar' }}"
        campaign_id: "{{ 'string' if target.type in  ('bigquery', 'spark', 'databricks') else 'varchar' }}"
        datetime: timestamp
        timestamp: timestamp
    klaviyo_metric:
      +tags: klaviyo
    klaviyo_campaign:
      +tags: klaviyo

flags:
  send_anonymous_usage_stats: False
